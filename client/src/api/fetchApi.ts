import axios from "axios"

export { fetchApi }

const BASE_URL = "http://localhost:3001/api/"

type methodType = "get" | "post"

async function fetchApi<responseT>(method: methodType, route: string, data?: any): Promise<{ data: responseT | null, status: number }> {
    const url = buildUrl(route);
    let responseData = null, status = 500;
    let response;
    try {
        switch (method) {
            case "get":
                response = await axios.get(url);
                responseData = response.data;
                status = response.status;
                break;
            case "post":
                response = await axios.post(url, data);
                responseData = response.data;
                status = response.status;
                break;
        }
        return { data: responseData, status };
    } catch (error: any) {
        console.warn(error)
        status = error?.response?.status;
        return { data: null, status: isNaN(status) ? 500 : status }
    }
}

function buildUrl(route: string) {
    return BASE_URL + route;
}