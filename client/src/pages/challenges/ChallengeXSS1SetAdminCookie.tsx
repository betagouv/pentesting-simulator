import { useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { fetchAdminCookie } from "../../api"
import { routes } from "../../routes";
import { storage } from "../../services";

export { ChallengeXSS1SetAdminCookie }

function ChallengeXSS1SetAdminCookie() {
    const navigate = useNavigate();

    useEffect(() => {
        setAdminCookie().then((hasSucceeded) => {
            if (hasSucceeded) {
                navigate(routes["challenge-list"].getPath())
            } else {
                navigate(routes["login"].getPath())
            }
        }).catch(() => {
            navigate(routes["login"].getPath())
        })
    })
    return <div />
}

async function setAdminCookie() {
    const userName = storage.user.getUserName();
    const password = storage.user.getPassword();
    const { data } = await fetchAdminCookie({ userName, password });
    if (data) {
        document.cookie = `ADMIN_COOKIE=${data};SameSite=Strict`
        return true;
    } else {
        return false;
    }
}