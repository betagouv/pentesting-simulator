import React, { ChangeEvent, FormEvent, useEffect, useState } from "react"
import { postMessageToForum, getMessagesFromForum } from "../../api";

export { Challenge2 }

function Challenge2() {
    const [messageToPost, setMessageToPost] = useState("");
    const [messages, setMessages] = useState<string[]>([]);
    useEffect(() => {
        getMessagesFromForum().then(({ data }) => {
            if (data) {
                setMessages(data as string[])
            }
        })
    }, [])
    return <>
        <header>Challenge 2</header>
        <p>L'administrateur vient souvent se balader sur cette page. Essayez de choper son cookie la prochaine fois qu'il vient !</p>
        <form onSubmit={onSubmit}>
            <input name="message" value={messageToPost} onChange={onChangeMessage} />
            <button type="submit">Soumettre</button>
        </form>
        ---------------------------
        <ul>
            {messages.map((message, index) => <li key={message + index}><div dangerouslySetInnerHTML={{ __html: message }} /></li>)}
        </ul>
    </>

    function onChangeMessage(e: ChangeEvent<HTMLInputElement>) {
        setMessageToPost(e.target.value);
    }

    async function onSubmit(event: FormEvent<HTMLFormElement>) {
        event.preventDefault();
        const { data, status } = await postMessageToForum(messageToPost)
        if (status === 201) {
            setMessageToPost("")
            setMessages(data as string[]);
        }
    }

}
