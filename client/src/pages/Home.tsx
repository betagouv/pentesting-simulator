import React, { ChangeEvent, useState } from 'react';
import { Link } from 'react-router-dom';
import { submitFlag } from '../api';
import { challenges } from '../challenges'

const INITIAL_FLAGS = challenges.reduce((acc, challenge) => ({ ...acc, [challenge.name]: "" }), {} as Record<string, string>)

function Home() {
  const [flags, setFlags] = useState(INITIAL_FLAGS);
  return (
    <div>
      <header >
        Pentesting simulator
      </header>
      <h1>Défis</h1>
      <ul>
        {challenges.map(({ name, path }) => (
          <li key={name}>
            <Link to={path}>Accéder au {name}</Link> - <input name={name} value={flags[name || ""]} onChange={buildOnChange(name)} />
            <button onClick={buildOnSubmitFlag(name)}>Soumettre le flag</button>
          </li>))}
      </ul>
    </div>
  );

  function buildOnChange(challengeName: string) {
    return (e: ChangeEvent<HTMLInputElement>) => {
      const value = e.target.value;
      setFlags({ ...flags, [challengeName]: value })
    }
  }

  function buildOnSubmitFlag(challengeName: string) {
    return () => submitFlag(challengeName, flags[challengeName])
  }
}

export { Home };
