import axios from "axios";
import { environment } from "../environment";

export { fetchApi };

type methodType = "get" | "post"

async function fetchApi<responseT>(method: methodType, route: string, data?: any): Promise<{ data: responseT | null, status: number, error: string | null }> {
    const url = buildUrl(route);
    let responseData = null, status = 500, error = null;
    let response;
    try {
        switch (method) {
            case "get":
                response = await axios.get(url);
                responseData = response.data;
                status = response.status;
                break;
            case "post":
                response = await axios.post(url, data);
                responseData = response.data;
                status = response.status;
                break;
        }
        return { data: responseData, status, error };
    } catch (error: any) {
        console.warn(error)
        status = error?.response?.status;
        return { data: null, status: isNaN(status) ? 500 : status, error: JSON.stringify(error.response.data) }
    }
}

function buildUrl(route: string) {
    return `http://${environment.API_URL}/${route}`;
}
